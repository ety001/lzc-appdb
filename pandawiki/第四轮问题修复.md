# ğŸ”§ ç¬¬å››è½®é—®é¢˜ä¿®å¤ - æœåŠ¡é€šä¿¡å’Œå¯åŠ¨ä¼˜åŒ–

## ğŸ“Š é—®é¢˜åˆ†æ

åŸºäºæœ€æ–°çš„åº”ç”¨æ—¥å¿—ï¼Œæˆ‘è¯†åˆ«å‡ºäº†ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

### ğŸš¨ ä¸»è¦é—®é¢˜

1. **NATS è¿æ¥è¶…æ—¶**:
   - `api-1` å’Œ `consumer-1` æœåŠ¡æ— æ³•è¿æ¥åˆ° NATS (169.254.15.13:4222)
   - é”™è¯¯: `panic: dial tcp 169.254.15.13:4222: i/o timeout`

2. **Minio æœåŠ¡åè§£æå¤±è´¥**:
   - `raglite-1` æœåŠ¡æ— æ³•è§£æ `minio` ä¸»æœºå
   - é”™è¯¯: `dial tcp: lookup minio on 127.0.0.11:53: server misbehaving`

3. **Nginx å¯åŠ¨å¤±è´¥**:
   - æ— æ³•æ‰¾åˆ°ä¸Šæ¸¸æœåŠ¡ `panda-wiki-api:8000`
   - é”™è¯¯: `nginx: [emerg] host not found in upstream "panda-wiki-api:8000"`

4. **æ•°æ®åº“é…ç½®é”™è¯¯**:
   - `raglite` æœåŠ¡è¿æ¥åˆ°é”™è¯¯çš„æ•°æ®åº“åç§°

## âœ… ä¿®å¤æªæ–½

### 1. ç¯å¢ƒå˜é‡è¡¥å…¨

**ä¸º `panda-wiki-nginx` æ·»åŠ ä¸Šæ¸¸æœåŠ¡é…ç½®**:
```yaml
environment:
  - API_HOST=panda-wiki-api:8000
  - APP_HOST=panda-wiki-app:8080
```

**ä¸º `panda-wiki-api` æ·»åŠ å®Œæ•´çš„æœåŠ¡ä¸»æœºé…ç½®**:
```yaml
environment:
  - POSTGRES_HOST=panda-wiki-postgres
  - NATS_HOST=panda-wiki-nats
  - REDIS_HOST=panda-wiki-redis
  - S3_ENDPOINT=panda-wiki-minio:9000
  - QDRANT_HOST=panda-wiki-qdrant
```

**ä¸º `panda-wiki-consumer` æ·»åŠ æœåŠ¡ä¸»æœºé…ç½®**:
```yaml
environment:
  - POSTGRES_HOST=panda-wiki-postgres
  - NATS_HOST=panda-wiki-nats
  - REDIS_HOST=panda-wiki-redis
  - S3_ENDPOINT=panda-wiki-minio:9000
  - QDRANT_HOST=panda-wiki-qdrant
```

### 2. æ•°æ®åº“é…ç½®ä¿®æ­£

**ä¿®æ­£ `panda-wiki-raglite` çš„æ•°æ®åº“åç§°**:
```yaml
- DATABASE_NAME=raglite  # ä» panda-wiki æ”¹ä¸º raglite
```

### 3. å¥åº·æ£€æŸ¥ä¼˜åŒ–

**ä¼˜åŒ–æ‰€æœ‰æœåŠ¡çš„å¥åº·æ£€æŸ¥é…ç½®**:

- **Nginx**: `start_period: 120s` (ç­‰å¾…ä¸Šæ¸¸æœåŠ¡å°±ç»ª)
- **API**: `start_period: 150s` (ç­‰å¾…æ‰€æœ‰ä¾èµ–æœåŠ¡)
- **NATS**: æ”¹ç”¨ HTTP å¥åº·æ£€æŸ¥ `curl -f http://localhost:8222/healthz`
- **Raglite**: `start_period: 180s` (ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ)

**ç»Ÿä¸€æ·»åŠ å¥åº·æ£€æŸ¥å‚æ•°**:
```yaml
interval: 10s-15s    # æ£€æŸ¥é—´éš”
timeout: 5s-10s      # è¶…æ—¶æ—¶é—´
retries: 3-5         # é‡è¯•æ¬¡æ•°
```

## ğŸ¯ é¢„æœŸæ•ˆæœ

1. **æœåŠ¡å‘ç°**: æ‰€æœ‰æœåŠ¡ç°åœ¨éƒ½æœ‰æ­£ç¡®çš„ä¸»æœºåç¯å¢ƒå˜é‡
2. **å¯åŠ¨é¡ºåº**: ä¼˜åŒ–çš„å¥åº·æ£€æŸ¥ç¡®ä¿æœåŠ¡æŒ‰æ­£ç¡®é¡ºåºå¯åŠ¨
3. **è¿æ¥ç¨³å®š**: å¢åŠ é‡è¯•å’Œè¶…æ—¶é…ç½®æé«˜è¿æ¥ç¨³å®šæ€§
4. **æ•°æ®åº“ä¸€è‡´æ€§**: `raglite` æœåŠ¡è¿æ¥åˆ°æ­£ç¡®çš„æ•°æ®åº“

## ğŸ”„ å»ºè®®æµ‹è¯•æ­¥éª¤

1. **é‡æ–°éƒ¨ç½²åº”ç”¨**
2. **ç›‘æ§æœåŠ¡å¯åŠ¨é¡ºåº**:
   - åŸºç¡€æœåŠ¡ (postgres, redis, nats, minio, qdrant) å…ˆå¯åŠ¨
   - ç„¶åæ˜¯ db-init åˆ›å»º raglite æ•°æ®åº“
   - æœ€åæ˜¯åº”ç”¨æœåŠ¡ (api, consumer, raglite, crawler, nginx)
3. **æ£€æŸ¥æœåŠ¡é—´è¿æ¥**:
   - API èƒ½å¦è¿æ¥åˆ° NATS
   - Raglite èƒ½å¦è¿æ¥åˆ° Minio
   - Nginx èƒ½å¦æ‰¾åˆ°ä¸Šæ¸¸æœåŠ¡

## ğŸ“ å…³é”®æ”¹è¿›ç‚¹

- âœ… **å®Œæ•´çš„ç¯å¢ƒå˜é‡é…ç½®**: æ‰€æœ‰æœåŠ¡éƒ½æœ‰æ˜ç¡®çš„ä¸»æœºå
- âœ… **ä¼˜åŒ–çš„å¥åº·æ£€æŸ¥**: æ›´é•¿çš„å¯åŠ¨ç­‰å¾…æ—¶é—´å’Œé‡è¯•æœºåˆ¶
- âœ… **æ­£ç¡®çš„æ•°æ®åº“é…ç½®**: Raglite è¿æ¥åˆ°æ­£ç¡®çš„æ•°æ®åº“
- âœ… **æ”¹è¿›çš„ NATS å¥åº·æ£€æŸ¥**: ä½¿ç”¨ HTTP ç«¯ç‚¹è€Œä¸æ˜¯ä¿¡å·

è¿™æ¬¡ä¿®å¤åº”è¯¥èƒ½å¤Ÿè§£å†³æ‰€æœ‰æœåŠ¡é—´é€šä¿¡å’Œå¯åŠ¨é¡ºåºé—®é¢˜ï¼
